<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Police Investigation Simulator</title>
<style>
  * {
    box-sizing: border-box;
  }
  html, body {
    margin: 0; padding: 0; height: 100%;
    font-family: Arial, sans-serif;
    background: #121212;
    color: #eee;
  }
  body.fullscreen {
    height: 100vh;
    overflow: hidden;
  }
  #loading-screen, #login-screen, #app {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: #222;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  #loading-screen.hidden, #login-screen.hidden, #app.hidden {
    display: none;
  }
  #loading-screen {
    font-size: 2em;
    font-weight: bold;
  }
  #login-screen input {
    font-size: 1.2em;
    padding: 10px;
    width: 300px;
    max-width: 80vw;
    margin-bottom: 20px;
    border-radius: 5px;
    border: none;
  }
  #login-screen button {
    font-size: 1.2em;
    padding: 10px 20px;
    background: #0078d7;
    border: none;
    border-radius: 5px;
    color: white;
    cursor: pointer;
  }
  #login-screen button:hover {
    background: #005fa3;
  }
  #app {
    display: flex;
    height: 100%;
  }
  #sidebar {
    width: 300px;
    background: #1e1e1e;
    border-right: 2px solid #333;
    overflow-y: auto;
    padding: 15px;
  }
  #sidebar h2 {
    margin-top: 0;
  }
  #sidebar ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #sidebar ul li {
    padding: 10px;
    margin-bottom: 5px;
    background: #2e2e2e;
    border-radius: 5px;
    cursor: pointer;
  }
  #sidebar ul li.selected {
    background: #0078d7;
    font-weight: bold;
  }
  #main {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 15px;
    overflow-y: auto;
    background: #181818;
  }
  #user-info {
    font-weight: bold;
    margin-bottom: 10px;
  }
  #case-desc {
    font-size: 1.1em;
    margin-bottom: 10px;
  }
  #radio-log, #weapon-log {
    white-space: pre-wrap;
    background: #252525;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 5px;
    max-height: 150px;
    overflow-y: auto;
  }
  #weapon-log ul {
    margin: 0; padding-left: 20px;
  }
  #witness-list, #suspect-list {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 15px;
  }
  .person-card {
    background: #2a2a2a;
    border-radius: 8px;
    padding: 10px;
    width: 250px;
    display: flex;
    gap: 10px;
    align-items: flex-start;
    flex-direction: column;
  }
  .person-card img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    align-self: center;
  }
  .person-name {
    font-weight: bold;
    font-size: 1.1em;
    text-align: center;
  }
  .person-details {
    font-size: 0.9em;
    color: #bbb;
  }
  .person-actions {
    margin-top: auto;
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    justify-content: center;
  }
  .person-actions button {
    background: #0078d7;
    border: none;
    border-radius: 5px;
    padding: 5px 8px;
    color: white;
    cursor: pointer;
    font-size: 0.9em;
    flex: 1 1 auto;
    min-width: 80px;
  }
  .person-actions button:hover {
    background: #005fa3;
  }
  .convict-checkbox-label {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-top: 10px;
    font-size: 0.9em;
    justify-content: center;
  }
  #controls {
    text-align: center;
    margin-top: auto;
  }
  #convict-btn, #next-case-btn, #logout-btn {
    background: #28a745;
    border: none;
    color: white;
    padding: 12px 25px;
    font-size: 1.1em;
    border-radius: 5px;
    cursor: pointer;
    margin: 0 8px;
  }
  #convict-btn:disabled {
    background: #555;
    cursor: default;
  }
  #next-case-btn {
    background: #17a2b8;
  }
  #logout-btn {
    background: #dc3545;
    position: fixed;
    top: 15px;
    right: 15px;
    padding: 8px 14px;
    font-size: 1em;
    z-index: 1000;
  }

  /* Modal styles */
  .modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
  }
  .modal {
    background: #222;
    border-radius: 10px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    padding: 20px;
    box-shadow: 0 0 20px #0078d7;
    color: #eee;
    position: relative;
  }
  .modal h3 {
    margin-top: 0;
  }
  .modal textarea {
    width: 100%;
    height: 300px;
    background: #1a1a1a;
    border: none;
    border-radius: 8px;
    color: #eee;
    font-family: monospace;
    font-size: 1em;
    padding: 10px;
    resize: none;
  }
  .modal-content-scroll {
    max-height: 300px;
    overflow-y: auto;
    font-size: 1em;
    line-height: 1.4em;
    background: #1a1a1a;
    border-radius: 8px;
    padding: 12px;
    white-space: pre-wrap;
  }
  .modal button.close-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #dc3545;
    border: none;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
  }
  .modal button.close-btn:hover {
    background: #a30000;
  }
  .modal button.action-btn {
    background: #0078d7;
    border: none;
    color: white;
    padding: 10px 18px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    margin: 10px 5px 0 0;
  }
  .modal button.action-btn:hover {
    background: #005fa3;
  }
  .modal .info-text {
    margin-top: 12px;
    font-style: italic;
  }

  /* Scrollbar for modal and logs */
  textarea, .modal-content-scroll, #radio-log, #weapon-log {
    scrollbar-width: thin;
    scrollbar-color: #0078d7 #121212;
  }
  textarea::-webkit-scrollbar, .modal-content-scroll::-webkit-scrollbar, #radio-log::-webkit-scrollbar, #weapon-log::-webkit-scrollbar {
    width: 8px;
  }
  textarea::-webkit-scrollbar-track, .modal-content-scroll::-webkit-scrollbar-track, #radio-log::-webkit-scrollbar-track, #weapon-log::-webkit-scrollbar-track {
    background: #121212;
  }
  textarea::-webkit-scrollbar-thumb, .modal-content-scroll::-webkit-scrollbar-thumb, #radio-log::-webkit-scrollbar-thumb, #weapon-log::-webkit-scrollbar-thumb {
    background-color: #0078d7;
    border-radius: 4px;
  }
</style>
</head>
<body class="fullscreen">

<!-- Loading Screen -->
<div id="loading-screen" class="">Loading... Please wait</div>

<!-- Login Screen -->
<div id="login-screen" class="hidden" role="dialog" aria-modal="true" aria-labelledby="login-title">
  <h2 id="login-title">Officer Login</h2>
  <input id="username-input" type="text" placeholder="Enter your officer name" aria-label="Officer name" autocomplete="off" />
  <button id="login-btn">Login</button>
</div>

<!-- Main App -->
<div id="app" class="hidden" role="main" aria-live="polite" aria-atomic="true" aria-label="Police investigation interface">
  <button id="logout-btn" aria-label="Logout">Logout</button>
  <div id="sidebar" aria-label="Case list">
    <h2>Cases</h2>
    <ul id="cases-ul" tabindex="0" role="listbox" aria-activedescendant=""></ul>
    <div id="user-info" aria-live="polite" aria-atomic="true"></div>
  </div>
  <div id="main">
    <div id="case-desc" tabindex="0"></div>
    <div id="radio-log" aria-label="Radio log" tabindex="0" role="region"></div>
    <div id="weapon-log" aria-label="Weapon log" tabindex="0" role="region"><ul></ul></div>

    <h3>Witnesses</h3>
    <div id="witness-list" aria-label="Witnesses"></div>

    <h3>Suspects</h3>
    <div id="suspect-list" aria-label="Suspects"></div>

    <div id="controls">
      <button id="convict-btn" disabled aria-disabled="true">Convict Selected Suspects</button>
      <button id="next-case-btn" class="hidden">Next Case</button>
    </div>
  </div>
</div>

<!-- Interview Modal -->
<div id="interview-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="interview-title">
  <div class="modal">
    <h3 id="interview-title"></h3>
    <textarea id="interview-log" readonly></textarea>
    <button class="close-btn" id="close-interview-btn" aria-label="Close interview">Close</button>
  </div>
</div>

<!-- Records Modal -->
<div id="records-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="records-title">
  <div class="modal">
    <h3 id="records-title"></h3>
    <div id="records-content" class="modal-content-scroll"></div>
    <button class="close-btn" id="close-records-btn" aria-label="Close records">Close</button>
  </div>
</div>

<!-- Warrant Modal -->
<div id="warrant-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="warrant-title">
  <div class="modal">
    <h3 id="warrant-title">Warrant Request</h3>
    <div id="warrant-result" class="info-text" style="font-size:1.3em; font-weight:bold; margin-bottom:10px;"></div>
    <button class="action-btn" id="court-case-btn" style="display:none;">Request Court Case</button>
    <div id="court-case-info" class="info-text"></div>
    <button class="action-btn" id="search-warrant-findings-btn" style="display:none;">View Search Warrant Findings</button>
    <div id="search-warrant-findings-info" class="info-text"></div>
    <button class="close-btn" id="close-warrant-btn" aria-label="Close warrant modal">Close</button>
  </div>
</div>

<script>
(() => {
  "use strict";

  // --- Data structures and initial cases ---

  // Example data for cases - You would add up to 100 similarly
  const cases = [
    {
      id: 1,
      title: "The Park Robbery",
      description: "A robbery occurred in Central Park. Several witnesses and suspects have been identified.",
      radioLog: "Dispatch: Robbery reported near Central Park.\nUnit 12: En route.",
      weaponLog: ["Knife found near the scene", "Gun reported by witness"],
      witnesses: [
        {
          id: 101,
          name: "Alice Johnson",
          headshot: "https://i.pravatar.cc/80?img=5",
          statement: "I saw someone running away with a backpack.",
          medicalRecords: "No known medical issues.",
          arrestRecords: "No prior arrests."
        },
        {
          id: 102,
          name: "Mark Lee",
          headshot: "https://i.pravatar.cc/80?img=15",
          statement: "He had a black hoodie and looked nervous.",
          medicalRecords: "Asthma, controlled with medication.",
          arrestRecords: "No prior arrests."
        }
      ],
      suspects: [
        {
          id: 201,
          name: "John Smith",
          headshot: "https://i.pravatar.cc/80?img=45",
          statement: "I was nowhere near the park.",
          medicalRecords: "High blood pressure.",
          arrestRecords: "One DUI 3 years ago.",
          searchWarrantFindings: "Found stolen goods in his apartment.",
          warrant: false,
          searchWarrantApproved: false,
          detained: false,
          convicted: false
        },
        {
          id: 202,
          name: "Sara Green",
          headshot: "https://i.pravatar.cc/80?img=32",
          statement: "I donâ€™t know anything about the robbery.",
          medicalRecords: "Healthy.",
          arrestRecords: "No prior arrests.",
          searchWarrantFindings: null,
          warrant: false,
          searchWarrantApproved: false,
          detained: false,
          convicted: false
        }
      ],
      solved: false,
      correctConviction: false,
      completed: false,
      completedTime: null
    },
    // You can add more cases here for testing or bulk generate later
  ];

  // --- Variables to track state ---
  let userName = null;
  let casesCompleted = 0;
  let selectedCaseIndex = null;
  let selectedSuspectIds = new Set();

  // --- DOM Elements ---
  const loadingScreen = document.getElementById('loading-screen');
  const loginScreen = document.getElementById('login-screen');
  const usernameInput = document.getElementById('username-input');
  const loginBtn = document.getElementById('login-btn');
  const logoutBtn = document.getElementById('logout-btn');
  const app = document.getElementById('app');
  const casesUl = document.getElementById('cases-ul');
  const userInfo = document.getElementById('user-info');
  const caseDesc = document.getElementById('case-desc');
  const radioLog = document.getElementById('radio-log');
  const weaponLog = document.getElementById('weapon-log').querySelector('ul');
  const witnessList = document.getElementById('witness-list');
  const suspectList = document.getElementById('suspect-list');
  const convictBtn = document.getElementById('convict-btn');
  const nextCaseBtn = document.getElementById('next-case-btn');

  // Modals
  const interviewModal = document.getElementById('interview-modal');
  const interviewTitle = document.getElementById('interview-title');
  const interviewLog = document.getElementById('interview-log');
  const closeInterviewBtn = document.getElementById('close-interview-btn');

  const recordsModal = document.getElementById('records-modal');
  const recordsTitle = document.getElementById('records-title');
  const recordsContent = document.getElementById('records-content');
  const closeRecordsBtn = document.getElementById('close-records-btn');

  const warrantModal = document.getElementById('warrant-modal');
  const warrantResult = document.getElementById('warrant-result');
  const courtCaseBtn = document.getElementById('court-case-btn');
  const courtCaseInfo = document.getElementById('court-case-info');
  const searchWarrantFindingsBtn = document.getElementById('search-warrant-findings-btn');
  const searchWarrantFindingsInfo = document.getElementById('search-warrant-findings-info');
  const closeWarrantBtn = document.getElementById('close-warrant-btn');

  // --- Utility ---
  function delay(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }

  // --- Local Storage Keys ---
  const STORAGE_KEY_NAME = 'police_sim_username';
  const STORAGE_KEY_COMPLETED = 'police_sim_cases_completed';

  // --- Save and Load ---
  function saveUserData() {
    if(userName) {
      localStorage.setItem(STORAGE_KEY_NAME, userName);
      localStorage.setItem(STORAGE_KEY_COMPLETED, casesCompleted);
    }
  }
  function loadUserData() {
    const savedName = localStorage.getItem(STORAGE_KEY_NAME);
    if(savedName) {
      userName = savedName;
    }
    const savedCompleted = localStorage.getItem(STORAGE_KEY_COMPLETED);
    casesCompleted = savedCompleted ? Number(savedCompleted) : 0;
  }

  // --- UI Updates ---
  function showLoadingScreen() {
    loadingScreen.classList.remove('hidden');
    loginScreen.classList.add('hidden');
    app.classList.add('hidden');
  }
  function hideLoadingScreen() {
    loadingScreen.classList.add('hidden');
  }
  function showLoginScreen() {
    loginScreen.classList.remove('hidden');
    app.classList.add('hidden');
    loadingScreen.classList.add('hidden');
  }
  function hideLoginScreen() {
    loginScreen.classList.add('hidden');
  }
  function showApp() {
    app.classList.remove('hidden');
    loginScreen.classList.add('hidden');
    loadingScreen.classList.add('hidden');
  }

  function updateUserInfo() {
    userInfo.textContent = `Officer: ${userName} | Cases Completed: ${casesCompleted}`;
  }

  function clearCaseDetail() {
    caseDesc.textContent = '';
    radioLog.textContent = '';
    weaponLog.innerHTML = '';
    witnessList.innerHTML = '';
    suspectList.innerHTML = '';
    convictBtn.disabled = true;
    convictBtn.setAttribute('aria-disabled', 'true');
    nextCaseBtn.classList.add('hidden');
    selectedSuspectIds.clear();
    selectedCaseIndex = null;
  }

  // --- Render Functions ---
  function renderCaseList() {
    casesUl.innerHTML = '';
    cases.forEach((c, i) => {
      if(c.completed) return; // Hide completed cases
      const li = document.createElement('li');
      li.textContent = c.title;
      li.id = `case-item-${c.id}`;
      li.tabIndex = 0;
      li.setAttribute('role', 'option');
      li.setAttribute('aria-selected', selectedCaseIndex === i ? 'true' : 'false');
      if(selectedCaseIndex === i) {
        li.classList.add('selected');
        casesUl.setAttribute('aria-activedescendant', li.id);
      }
      li.addEventListener('click', () => {
        selectCase(i);
      });
      li.addEventListener('keydown', e => {
        if(e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          selectCase(i);
        }
      });
      casesUl.appendChild(li);
    });
  }

  function selectCase(index) {
    selectedCaseIndex = index;
    selectedSuspectIds.clear();
    renderCaseList();
    renderCaseDetail();
  }

  function renderCaseDetail() {
    if(selectedCaseIndex === null) {
      clearCaseDetail();
      return;
    }
    const c = cases[selectedCaseIndex];
    caseDesc.textContent = c.description;
    radioLog.textContent = c.radioLog;
    weaponLog.innerHTML = '';
    c.weaponLog = c.weaponLog || c.weaponLog || c.weaponLog === undefined ? c.weaponLog || [] : [];
    if(Array.isArray(c.weaponLog)) {
      for(let w of c.weaponLog) {
        const li = document.createElement('li');
        li.textContent = w;
        weaponLog.appendChild(li);
      }
    }
    // Witnesses
    witnessList.innerHTML = '';
    c.witnesses.forEach(w => {
      witnessList.appendChild(createPersonCard(w, false));
    });
    // Suspects
    suspectList.innerHTML = '';
    c.suspects.forEach(s => {
      suspectList.appendChild(createPersonCard(s, true));
    });

    convictBtn.disabled = selectedSuspectIds.size === 0;
    convictBtn.setAttribute('aria-disabled', selectedSuspectIds.size === 0 ? 'true' : 'false');
  }

  function createPersonCard(person, isSuspect) {
    const card = document.createElement('div');
    card.className = 'person-card';

    const img = document.createElement('img');
    img.src = person.headshot;
    img.alt = `Headshot of ${person.name}`;
    card.appendChild(img);

    const name = document.createElement('div');
    name.className = 'person-name';
    name.textContent = person.name;
    card.appendChild(name);

    const details = document.createElement('div');
    details.className = 'person-details';
    details.textContent = person.statement;
    card.appendChild(details);

    const actions = document.createElement('div');
    actions.className = 'person-actions';

    // Interview Button
    const interviewBtn = document.createElement('button');
    interviewBtn.textContent = 'Interview';
    interviewBtn.onclick = () => openInterviewModal(person);
    actions.appendChild(interviewBtn);

    // Records Button (medical + arrest)
    const recordsBtn = document.createElement('button');
    recordsBtn.textContent = 'Records';
    recordsBtn.onclick = () => openRecordsModal(person);
    actions.appendChild(recordsBtn);

    if(isSuspect) {
      // Warrant Button
      const warrantBtn = document.createElement('button');
      warrantBtn.textContent = 'Request Warrant';
      warrantBtn.onclick = () => requestWarrant(person);
      actions.appendChild(warrantBtn);

      // Detain Button
      const detainBtn = document.createElement('button');
      detainBtn.textContent = person.detained ? 'Detained' : 'Detain';
      detainBtn.disabled = person.detained;
      detainBtn.onclick = () => {
        detainSuspect(person);
        detainBtn.textContent = 'Detained';
        detainBtn.disabled = true;
      };
      actions.appendChild(detainBtn);

      // Convict Checkbox
      const convictLabel = document.createElement('label');
      convictLabel.className = 'convict-checkbox-label';
      const convictCheckbox = document.createElement('input');
      convictCheckbox.type = 'checkbox';
      convictCheckbox.checked = selectedSuspectIds.has(person.id);
      convictCheckbox.onchange = (e) => {
        if(e.target.checked) {
          selectedSuspectIds.add(person.id);
        } else {
          selectedSuspectIds.delete(person.id);
        }
        convictBtn.disabled = selectedSuspectIds.size === 0;
        convictBtn.setAttribute('aria-disabled', selectedSuspectIds.size === 0 ? 'true' : 'false');
      };
      convictLabel.appendChild(convictCheckbox);
      convictLabel.appendChild(document.createTextNode('Convict'));
      actions.appendChild(convictLabel);
    }

    card.appendChild(actions);

    // Add "View Search Warrant" link if approved
    if(isSuspect && person.searchWarrantApproved) {
      const warrantViewBtn = document.createElement('button');
      warrantViewBtn.textContent = 'View Search Warrant';
      warrantViewBtn.onclick = () => {
        searchWarrantFindingsInfo.textContent = person.searchWarrantFindings || 'No findings.';
        searchWarrantFindingsBtn.style.display = 'inline-block';
        warrantResult.textContent = "APPROVED";
        courtCaseBtn.style.display = 'none';
        courtCaseInfo.textContent = '';
        warrantModal.classList.remove('hidden');
      };
      actions.appendChild(warrantViewBtn);
    }

    return card;
  }

  // --- Modal Functions ---

  // Interview modal shows entire interview log at once
  function openInterviewModal(person) {
    interviewTitle.textContent = `Interview with ${person.name}`;
    // For demo: use the statement repeated multiple times as interview log
    const interviewText = `${person.statement}\n\n---\nFull interview transcript:\n\n${person.statement}\n${person.statement}\n${person.statement}`;
    interviewLog.textContent = interviewText;
    interviewModal.classList.remove('hidden');
  }
  closeInterviewBtn.onclick = () => interviewModal.classList.add('hidden');

  // Records modal shows medical + arrest records
  function openRecordsModal(person) {
    recordsTitle.textContent = `Records for ${person.name}`;
    recordsContent.innerHTML = `<p><strong>Medical:</strong> ${person.medicalRecords || 'N/A'}</p><p><strong>Arrest:</strong> ${person.arrestRecords || 'N/A'}</p>`;
    recordsModal.classList.remove('hidden');
  }
  closeRecordsBtn.onclick = () => recordsModal.classList.add('hidden');

  // Warrant modal interactions
  function requestWarrant(person) {
    if(person.warrant) {
      alert('Warrant already requested.');
      return;
    }
    // Simulate warrant approval logic
    person.warrant = true;
    const approved = Math.random() < 0.7; // 70% chance approved
    person.searchWarrantApproved = approved;
    person.searchWarrantFindings = approved ? "Stolen goods and evidence found." : null;
    warrantResult.textContent = approved ? "APPROVED" : "DENIED";
    courtCaseBtn.style.display = approved ? 'inline-block' : 'none';
    courtCaseInfo.textContent = '';
    searchWarrantFindingsBtn.style.display = 'none';
    searchWarrantFindingsInfo.textContent = '';
    warrantModal.classList.remove('hidden');

    // Update UI to show the "View Search Warrant" button if approved next time
    renderCaseDetail();
  }

  searchWarrantFindingsBtn.onclick = () => {
    searchWarrantFindingsInfo.style.display = searchWarrantFindingsInfo.style.display === 'none' ? 'block' : 'none';
  };
  closeWarrantBtn.onclick = () => warrantModal.classList.add('hidden');

  // --- Conviction logic ---
  convictBtn.onclick = () => {
    if(selectedSuspectIds.size === 0) return;
    const c = cases[selectedCaseIndex];
    let correct = false;
    // Assume correct if any convicted suspect had search warrant approved and findings
    for(const id of selectedSuspectIds) {
      const suspect = c.suspects.find(s => s.id === id);
      if(suspect && suspect.searchWarrantApproved && suspect.searchWarrantFindings) {
        correct = true;
        suspect.convicted = true;
      } else if(suspect) {
        suspect.convicted = false;
      }
    }
    c.solved = true;
    c.correctConviction = correct;
    c.completed = true;
    c.completedTime = new Date().toISOString();
    casesCompleted++;
    saveUserData();
    updateUserInfo();
    clearCaseDetail();
    renderCaseList();
    nextCaseBtn.classList.remove('hidden');
  };

  nextCaseBtn.onclick = () => {
    nextCaseBtn.classList.add('hidden');
    // Automatically select next available case
    const nextIndex = cases.findIndex(c => !c.completed);
    if(nextIndex !== -1) {
      selectCase(nextIndex);
    } else {
      alert('No more cases available.');
    }
  };

  // --- Login and Initialization ---
  loginBtn.onclick = () => {
    const val = usernameInput.value.trim();
    if(val.length === 0) {
      alert('Please enter a username.');
      return;
    }
    userName = val;
    casesCompleted = 0;
    saveUserData();
    updateUserInfo();
    hideLoginScreen();
    showApp();
    renderCaseList();
  };

  logoutBtn.onclick = () => {
    userName = null;
    casesCompleted = 0;
    localStorage.removeItem(STORAGE_KEY_NAME);
    localStorage.removeItem(STORAGE_KEY_COMPLETED);
    clearCaseDetail();
    updateUserInfo();
    showLoginScreen();
    hideApp();
  };

  function hideApp() {
    app.classList.add('hidden');
  }

  // On load
  (async () => {
    showLoadingScreen();
    await delay(1500); // simulate loading
    loadUserData();
    if(userName) {
      updateUserInfo();
      showApp();
      renderCaseList();
    } else {
      showLoginScreen();
    }
    hideLoadingScreen();
  })();

})();
</script>
</body>
</html>

