<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Detective Case Manager</title>
  <style>
    body {
      background: #121212;
      color: #ddd;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 0;
      display: flex; flex-direction: column; min-height: 100vh;
    }
    header {
      background: #1f2937;
      padding: 1rem;
      text-align: center;
      font-weight: bold;
      font-size: 1.5rem;
      color: #e0e7ff;
    }
    main {
      flex-grow: 1;
      padding: 1rem;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
    }
    section {
      background: #1e293b;
      border-radius: 8px;
      padding: 1rem;
      flex: 1 1 300px;
      max-width: 480px;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      box-sizing: border-box;
    }
    h2 {
      margin-top: 0;
      border-bottom: 1px solid #334155;
      padding-bottom: 0.5rem;
      font-weight: 600;
    }
    button {
      background: #3b82f6;
      border: none;
      border-radius: 5px;
      padding: 0.5rem 1rem;
      color: white;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }
    button:disabled {
      background: #64748b;
      cursor: not-allowed;
    }
    button:hover:not(:disabled) {
      background: #2563eb;
    }
    ul {
      list-style-type: none;
      padding-left: 0;
      margin: 0;
      max-height: 160px;
      overflow-y: auto;
      border: 1px solid #334155;
      border-radius: 5px;
      background: #0f172a;
    }
    li {
      padding: 0.3rem 0.6rem;
      border-bottom: 1px solid #334155;
      font-size: 0.9rem;
    }
    li:last-child {
      border-bottom: none;
    }
    label {
      cursor: pointer;
    }
    input[type="checkbox"] {
      margin-right: 0.3rem;
      cursor: pointer;
    }
    .small-btn {
      background: #2563eb;
      font-size: 0.8rem;
      padding: 0.25rem 0.5rem;
      margin-left: 0.3rem;
      border-radius: 4px;
    }
    .small-btn:disabled {
      background: #64748b;
    }
    .flex-between {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .flex-center {
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .hidden {
      display: none !important;
    }
    .log-panel {
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 5px;
      padding: 0.5rem;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      font-family: monospace;
      font-size: 0.9rem;
    }
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    .modal {
      background: #1e293b;
      padding: 1.5rem;
      border-radius: 10px;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      box-sizing: border-box;
      color: #ddd;
    }
    .modal h3 {
      margin-top: 0;
    }
    .modal button {
      margin-top: 1rem;
    }
    .records-section {
      border: 1px solid #334155;
      padding: 0.6rem;
      border-radius: 5px;
      background: #0f172a;
      max-height: 140px;
      overflow-y: auto;
      font-size: 0.85rem;
      font-family: monospace;
    }
    .suspect-card {
      background: #273449;
      border-radius: 8px;
      padding: 0.75rem;
      margin-bottom: 0.8rem;
    }
    .suspect-header {
      display: flex;
      gap: 1rem;
      align-items: center;
    }
    .suspect-img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #64748b;
    }
    .suspect-name {
      font-weight: 700;
      font-size: 1.1rem;
      color: #e0e7ff;
    }
    .record-btns {
      display: flex;
      gap: 0.4rem;
      margin-top: 0.3rem;
      flex-wrap: wrap;
    }
    .log-link {
      cursor: pointer;
      color: #60a5fa;
      text-decoration: underline;
      font-size: 0.9rem;
    }
    .log-link:hover {
      color: #3b82f6;
    }
  </style>
</head>
<body>
  <header>ðŸš“ Detective Case Manager</header>
  <main>
    <section id="intro-section">
      <h2>Start Your Duty</h2>
      <label for="officerName">Officer Name:</label><br />
      <input type="text" id="officerName" placeholder="Enter your name" autocomplete="off" style="width: 100%; padding: 0.5rem; margin-bottom: 0.8rem; border-radius: 5px; border: 1px solid #334155; background: #0f172a; color: #ddd;" />
      <button id="startBtn">Start Duty</button>
      <button id="eraseBtn" style="margin-left: 1rem; background:#dc2626;">Erase History</button>
    </section>

    <section id="case-section" class="hidden">
      <h2>Case #<span id="caseNumber">-</span> (ID: <span id="caseID">-</span>)</h2>
      <p id="caseDescription" style="font-size:0.95rem; line-height: 1.3;"></p>

      <div>
        <h3>Radio Log</h3>
        <div class="log-panel" id="radioLog" aria-live="polite"></div>
      </div>

      <div>
        <h3>Weapon Log</h3>
        <ul id="weaponLog"></ul>
      </div>

      <div>
        <h3>Witnesses</h3>
        <div id="witnessList"></div>
      </div>

      <div>
        <h3>Suspects</h3>
        <div id="suspectList"></div>
      </div>

      <div style="display: flex; justify-content: space-between; margin-top: 1rem; flex-wrap: wrap; gap: 0.5rem;">
        <button id="convictBtn" disabled>Convict Selected Suspect(s)</button>
        <button id="nextCaseBtn" class="hidden">Next Case</button>
        <button id="logoutBtn" style="background:#6b7280;">Logout</button>
      </div>
    </section>
  </main>

  <!-- Interview Modal -->
  <div id="interviewModal" class="modal-backdrop hidden" role="dialog" aria-modal="true" aria-labelledby="interviewTitle">
    <div class="modal">
      <h3 id="interviewTitle">Interview</h3>
      <div id="interviewLog" class="log-panel" tabindex="0" style="white-space: pre-line;"></div>
      <button id="closeInterviewBtn">Close Interview</button>
    </div>
  </div>

  <!-- Warrant Modal -->
  <div id="warrantModal" class="modal-backdrop hidden" role="dialog" aria-modal="true" aria-labelledby="warrantTitle">
    <div class="modal">
      <h3 id="warrantTitle">Judge Hearing</h3>
      <p id="warrantRequestText"></p>
      <div id="judgeDialogue" style="margin-top:1rem; background:#0f172a; padding:1rem; border-radius: 8px; max-height: 200px; overflow-y:auto; font-family: monospace; font-size: 0.9rem;"></div>
      <div style="margin-top: 1rem; display:flex; gap: 0.5rem; flex-wrap: wrap;">
        <button id="judgeApproveBtn">Approve Warrant</button>
        <button id="judgeDenyBtn">Deny Warrant</button>
        <button id="judgeCloseBtn" class="hidden">Close</button>
      </div>
    </div>
  </div>

  <!-- Records Modal -->
  <div id="recordsModal" class="modal-backdrop hidden" role="dialog" aria-modal="true" aria-labelledby="recordsTitle">
    <div class="modal" style="max-width: 520px;">
      <h3 id="recordsTitle">Records</h3>
      <div id="recordsContent" class="records-section"></div>
      <button id="closeRecordsBtn" style="margin-top: 1rem;">Close Records</button>
    </div>
  </div>

<script>
  // Data for 100 cases (here simplified to a few for demo)
  const cases = [
    {
      id: "CASE1001",
      description: "Burglary at 123 Maple St. Neighbors report suspicious activity.",
      radioLog: [
        "Dispatch: Units respond to 123 Maple St. for reported burglary.",
        "Officer: On scene, looking for suspects.",
      ],
      weaponLog: ["Baseball Bat", "Crowbar"],
      witnesses: [
        { id: "W1", name: "Alice Thompson", interviewed: false, statements: [
          {question: "Did you see the suspect?", answer: "Yes, a tall man in a dark hoodie."},
          {question: "Did you hear any noises?", answer: "Yes, breaking glass around 2am."}
        ]},
        { id: "W2", name: "Bob Jenkins", interviewed: false, statements: [
          {question: "Did you notice any vehicles?", answer: "A black sedan speeding away."},
          {question: "Did you see the suspect's face?", answer: "No, it was too dark."}
        ]},
      ],
      suspects: [
        { 
          id: "S1",
          name: "Mark R.",
          licenseId: "D1234567",
          plate: "XYZ 123",
          record: "Theft (2019), Vandalism (2021)",
          warrant: false,
          searchWarrant: false,
          arrestWarrant: false,
          interviewed: false,
          headshot: "https://randomuser.me/api/portraits/men/32.jpg",
          medicalRecords: "No known medical issues.",
          arrestRecords: "Theft 2019, Vandalism 2021",
          statements: [
            {question: "Where were you at 2am?", answer: "I was home watching TV."},
            {question: "Do you own a baseball bat?", answer: "Yes, for baseball practice."},
            {question: "Do you know anyone who might do this?", answer: "No, I don't."}
          ]
        },
        { 
          id: "S2",
          name: "Jenny K.",
          licenseId: "E7654321",
          plate: "ABC 789",
          record: "None",
          warrant: false,
          searchWarrant: false,
          arrestWarrant: false,
          interviewed: false,
          headshot: "https://randomuser.me/api/portraits/women/45.jpg",
          medicalRecords: "Asthma, uses inhaler occasionally.",
          arrestRecords: "None",
          statements: [
            {question: "Where were you at 2am?", answer: "I was at a friend's place."},
            {question: "Do you own a crowbar?", answer: "No, I don't."},
            {question: "Have you been to 123 Maple St. before?", answer: "Once, for a delivery."}
          ]
        }
      ],
      solved: false,
      correctConviction: false
    },
    // Additional cases can be added here similarly...
  ];

  let currentCaseIndex = 0;
  let convictedSuspects = new Set();
  let completedCases = new Set(JSON.parse(localStorage.getItem('completedCases') || '[]'));
  const interviewLogs = {}; // Store interview logs by id for later review

  // DOM elements
  const introSection = document.getElementById('intro-section');
  const caseSection = document.getElementById('case-section');

  const officerNameInput = document.getElementById('officerName');
  const startBtn = document.getElementById('startBtn');
  const eraseBtn = document.getElementById('eraseBtn');

  const caseNumberDisplay = document.getElementById('caseNumber');
  const caseIDDisplay = document.getElementById('caseID');
  const caseDescription = document.getElementById('caseDescription');
  const radioLogEl = document.getElementById('radioLog');
  const weaponLogEl = document.getElementById('weaponLog');
  const witnessList = document.getElementById('witnessList');
  const suspectList = document.getElementById('suspectList');

  const convictBtn = document.getElementById('convictBtn');
  const nextCaseBtn = document.getElementById('nextCaseBtn');
  const logoutBtn = document.getElementById('logoutBtn');

  // Interview Modal
  const interviewModal = document.getElementById('interviewModal');
  const interviewTitle = document.getElementById('interviewTitle');
  const interviewLogEl = document.getElementById('interviewLog');
  const closeInterviewBtn = document.getElementById('closeInterviewBtn');

  // Warrant Modal (Judge Hearing)
  const warrantModal = document.getElementById('warrantModal');
  const warrantRequestText = document.getElementById('warrantRequestText');
  const judgeDialogue = document.getElementById('judgeDialogue');
  const judgeApproveBtn = document.getElementById('judgeApproveBtn');
  const judgeDenyBtn = document.getElementById('judgeDenyBtn');
  const judgeCloseBtn = document.getElementById('judgeCloseBtn');

  // Records Modal
  const recordsModal = document.getElementById('recordsModal');
  const recordsTitle = document.getElementById('recordsTitle');
  const recordsContent = document.getElementById('recordsContent');
  const closeRecordsBtn = document.getElementById('closeRecordsBtn');

  // Helpers
  function saveProgress() {
    localStorage.setItem('completedCases', JSON.stringify(Array.from(completedCases)));
    localStorage.setItem('officerName', officerNameInput.value.trim());
    localStorage.setItem('interviewLogs', JSON.stringify(interviewLogs));
  }

  function loadProgress() {
    const logs = localStorage.getItem('interviewLogs');
    if(logs) {
      Object.assign(interviewLogs, JSON.parse(logs));
    }
  }

  // Random utility for judge suspicion chance
  function randomChance(prob) {
    return Math.random() < prob;
  }

  // Start Game
  function startGame() {
    const name = officerNameInput.value.trim();
    if(!name) {
      alert("Please enter your officer name.");
      return;
    }
    introSection.classList.add('hidden');
    caseSection.classList.remove('hidden');

    // Load saved interview logs
    loadProgress();

    // Find first unsolved case
    currentCaseIndex = 0;
    while(currentCaseIndex < cases.length && completedCases.has(cases[currentCaseIndex].id)) {
      currentCaseIndex++;
    }
    if(currentCaseIndex >= cases.length) {
      alert("All cases solved! Great job.");
      currentCaseIndex = 0;
    }
    loadCase(currentCaseIndex);
  }

  // Erase history
  function eraseHistory() {
    if(confirm("Erase all progress and history? This cannot be undone.")) {
      localStorage.clear();
      completedCases.clear();
      for(const c of cases) {
        c.solved = false;
        c.correctConviction = false;
        c.suspects.forEach(s => {
          s.interviewed = false;
          s.warrant = false;
          s.searchWarrant = false;
          s.arrestWarrant = false;
        });
        c.witnesses.forEach(w => w.interviewed = false);
      }
      convictedSuspects.clear();
      introSection.classList.remove('hidden');
      caseSection.classList.add('hidden');
    }
  }

  // Logout
  function logout() {
    convictedSuspects.clear();
    introSection.classList.remove('hidden');
    caseSection.classList.add('hidden');
  }

  // Load case UI
  function loadCase(index) {
    convictedSuspects.clear();
    convictBtn.disabled = true;
    nextCaseBtn.classList.add('hidden');
    const c = cases[index];
    caseNumberDisplay.textContent = index + 1;
    caseIDDisplay.textContent = c.id;
    caseDescription.textContent = c.description;

    // Radio log
    radioLogEl.textContent = c.radioLog.join('\n');

    // Weapon log
    weaponLogEl.innerHTML = '';
    for(const w of c.weaponLog) {
      const li = document.createElement('li');
      li.textContent = w;
      weaponLogEl.appendChild(li);
    }

    // Witnesses
    witnessList.innerHTML = '';
    for(const w of c.witnesses) {
      const card = createPersonCard(w, false);
      witnessList.appendChild(card);
    }

    // Suspects
    suspectList.innerHTML = '';
    for(const s of c.suspects) {
      const card = createPersonCard(s, true);
      suspectList.appendChild(card);
    }
  }

  // Create witness or suspect card
  function createPersonCard(person, isSuspect) {
    const div = document.createElement('div');
    div.className = 'suspect-card';
    if(isSuspect) {
      div.innerHTML = `
        <div class="suspect-header">
          <img class="suspect-img" src="${person.headshot}" alt="Headshot of ${person.name}" />
          <div>
            <div class="suspect-name">${person.name}</div>
            <div>ID: ${person.licenseId} | Plate: ${person.plate}</div>
            <div>Record: ${person.record}</div>
          </div>
        </div>
        <div class="record-btns">
          <button class="small-btn" data-action="interview" data-id="${person.id}">Interview</button>
          <button class="small-btn" data-action="review" data-id="${person.id}">Review Interview</button>
          <button class="small-btn" data-action="warrant" data-id="${person.id}">Request Warrant</button>
          <button class="small-btn" data-action="medical" data-id="${person.id}">Medical Records</button>
          <button class="small-btn" data-action="arrest" data-id="${person.id}">Arrest Records</button>
          <label><input type="checkbox" class="convict-checkbox" data-id="${person.id}"/> Convict</label>
        </div>
      `;
    } else {
      div.innerHTML = `
        <div class="suspect-header">
          <div class="suspect-name">${person.name}</div>
        </div>
        <div class="record-btns">
          <button class="small-btn" data-action="interview" data-id="${person.id}">Interview</button>
          <button class="small-btn" data-action="review" data-id="${person.id}">Review Interview</button>
        </div>
      `;
    }

    // Event delegation on buttons
    div.querySelectorAll('button').forEach(btn => {
      btn.addEventListener('click', () => handlePersonAction(btn.dataset.action, person));
    });

    // Checkbox event for conviction
    if(isSuspect) {
      const checkbox = div.querySelector('.convict-checkbox');
      checkbox.checked = convictedSuspects.has(person.id);
      checkbox.addEventListener('change', e => {
        if(e.target.checked) {
          convictedSuspects.add(person.id);
        } else {
          convictedSuspects.delete(person.id);
        }
        convictBtn.disabled = convictedSuspects.size === 0;
      });
    }

    return div;
  }

  // Handle suspect/witness button actions
  function handlePersonAction(action, person) {
    if(action === "interview") {
      startInterview(person);
    } else if(action === "review") {
      reviewInterview(person);
    } else if(action === "warrant") {
      requestWarrant(person);
    } else if(action === "medical") {
      showRecords("Medical Records", person.medicalRecords || "No medical records available.");
    } else if(action === "arrest") {
      showRecords("Arrest Records", person.arrestRecords || "No arrest records available.");
    }
  }

  // Start interview (show entire transcript)
  function startInterview(person) {
    if(person.interviewed) {
      if(!confirm("You have already interviewed this person. Start a new interview? This will overwrite previous interview.")) {
        return;
      }
    }
    // Compose transcript
    let transcript = `Interview with ${person.name}:\n\n`;
    if(person.statements && person.statements.length) {
      for(const q of person.statements) {
        transcript += `Q: ${q.question}\nA: ${q.answer}\n\n`;
      }
    } else {
      transcript += "No statements available.";
    }
    // Save interview log
    interviewLogs[person.id] = transcript;
    person.interviewed = true;
    saveProgress();

    // Show transcript
    interviewTitle.textContent = `Interview: ${person.name}`;
    interviewLogEl.textContent = transcript;
    interviewModal.classList.remove('hidden');
    interviewLogEl.focus();
  }

  // Review interview logs
  function reviewInterview(person) {
    const log = interviewLogs[person.id];
    if(!log) {
      alert("No interview log found for this person.");
      return;
    }
    interviewTitle.textContent = `Review Interview: ${person.name}`;
    interviewLogEl.textContent = log;
    interviewModal.classList.remove('hidden');
    interviewLogEl.focus();
  }

  closeInterviewBtn.onclick = () => {
    interviewModal.classList.add('hidden');
  };

  // Show records modal
  function showRecords(title, content) {
    recordsTitle.textContent = title;
    recordsContent.textContent = content;
    recordsModal.classList.remove('hidden');
  }

  closeRecordsBtn.onclick = () => {
    recordsModal.classList.add('hidden');
  };

  // Request warrant (judge interaction)
  function requestWarrant(person) {
    warrantRequestText.textContent = `Officer requests a warrant for ${person.name}.`;

    // Reset judge dialogue and buttons
    judgeDialogue.textContent = "";
    judgeApproveBtn.disabled = false;
    judgeDenyBtn.disabled = false;
    judgeCloseBtn.classList.add('hidden');
    judgeApproveBtn.classList.remove('hidden');
    judgeDenyBtn.classList.remove('hidden');

    warrantModal.classList.remove('hidden');

    // Simulate judge questioning with suspicious chance
    judgeDialogue.textContent = "Judge: Please explain your reasons for the warrant request.\n";

    // We'll simulate dialogue lines on judge suspicion with pauses:
    let dialogueLines = [
      "Officer: There is reasonable suspicion based on witness statements and evidence.",
      "Judge: Have you verified the credibility of these witnesses?",
      "Officer: Yes, to the best of our knowledge.",
      "Judge: Is there any prior record indicating criminal behavior?",
      "Officer: Yes, suspect has a prior theft and vandalism record.",
      "Judge: I see."
    ];
    let currentLine = 0;
    let suspicionTriggered = false;

    function nextLine() {
      if(currentLine < dialogueLines.length) {
        judgeDialogue.textContent += "\n" + dialogueLines[currentLine];
        currentLine++;
        if(currentLine === 3 && randomChance(0.3)) {
          // Suspicion triggered at line 3, judge gets suspicious and ends hearing
          suspicionTriggered = true;
          judgeDialogue.textContent += "\n\nJudge: Your explanations are not satisfactory. I am denying the warrant and ending this hearing.";
          judgeApproveBtn.disabled = true;
          judgeDenyBtn.disabled = true;
          judgeCloseBtn.classList.remove('hidden');
          judgeApproveBtn.classList.add('hidden');
          judgeDenyBtn.classList.add('hidden');
          return;
        }
        setTimeout(nextLine, 1000);
      }
    }
    nextLine();

    judgeApproveBtn.onclick = () => {
      person.warrant = true;
      alert(`Warrant approved for ${person.name}.`);
      saveProgress();
      warrantModal.classList.add('hidden');
    };

    judgeDenyBtn.onclick = () => {
      alert(`Warrant denied for ${person.name}.`);
      warrantModal.classList.add('hidden');
    };

    judgeCloseBtn.onclick = () => {
      warrantModal.classList.add('hidden');
    };
  }

  // Convict suspects and verify solution
  function convictSuspectsAndVerify() {
    const c = cases[currentCaseIndex];
    if(convictedSuspects.size === 0) return;

    // Mark suspects convicted
    for(const s of c.suspects) {
      s.convicted = convictedSuspects.has(s.id);
    }

    // For demo, let's say suspect S1 is guilty for case 1001, and all else is innocent
    let guiltySuspects = new Set(["S1"]);

    let correct = true;
    for(const s of c.suspects) {
      if(s.convicted !== guiltySuspects.has(s.id)) {
        correct = false;
      }
    }

    c.solved = true;
    c.correctConviction = correct;
    completedCases.add(c.id);
    saveProgress();

    if(correct) {
      alert("Case solved correctly! Good job, Officer.");
    } else {
      alert("Case conviction was incorrect. Review the evidence and try again.");
    }

    nextCaseBtn.classList.remove('hidden');
    convictBtn.disabled = true;
  }

  // Load next case
  function nextCase() {
    currentCaseIndex++;
    while(currentCaseIndex < cases.length && completedCases.has(cases[currentCaseIndex].id)) {
      currentCaseIndex++;
    }
    if(currentCaseIndex >= cases.length) {
      alert("No more unsolved cases available.");
      return;
    }
    loadCase(currentCaseIndex);
  }

  // Event listeners
  startBtn.addEventListener('click', startGame);
  eraseBtn.addEventListener('click', eraseHistory);
  logoutBtn.addEventListener('click', logout);
  convictBtn.addEventListener('click', convictSuspectsAndVerify);
  nextCaseBtn.addEventListener('click', nextCase);

</script>
</body>
</html>
